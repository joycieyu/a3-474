
// JSON for our data - credits to Kaggle
var twentyEleven =
{
	"name" : "2011",
	"children" : [
		{
			"name" : "Male",
			"children" : [
				{
					"name" : "Asian and Pacific Islander",
					"children" : [
						{"name" : "Ethan",
							"children": [
								{"name": "#1 in NYC"},
								{"name": "#7 in USA"},
							]			
						},
						{"name" : "Jayden",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#4 in USA"},
						]	
					},
						{"name" : "Ryan",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#25 in USA"},
						]	
					},
					]
				},
				{
					"name" : "Black",
					"children" : [
						{"name" : "Jayden",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#4 in USA"},
						]
					},
						{"name" : "Aiden",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#9 in USA"},
						]
					
					},
						{"name" : "Elijah",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#13 in USA"},
						]
					
					},
					]
				},
				{
					"name" : "Hispanic",
					"children" : [
						{"name" : "Jayden",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#4 in USA"},
						]
					},
						{"name" : "Justin",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#59 in USA"},
						]
					},
						{"name" : "Jacob",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#1 in USA"},
						]
					},
					]
				},
				{
					"name" : "White",
					"children" : [
						{"name" : "Michael",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#6 in USA"},
						]
					},
						{"name" : "Joseph",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#22 in USA"},
						]
					},
						{"name" : "Jacob",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#1 in USA"},
						]
					},

					]
				}
			]
		},
		{
			"name" : "Female",
			"children" : [
				{
					"name" : "Asian and Pacific Islander",
					"children" : [
						{"name" : "Sophia",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#1 in USA"},
						]
					},
						{"name" : "Chloe",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#10 in USA"},
						]
					},
						{"name" : "Emily",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#6 in USA"},
						]
					},
					]
				},
				{
					"name" : "Black",
					"children" : [
						{"name" : "Madison",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#8 in USA"},
						]
					},
						{"name" : "London",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#94 in USA"},
						]
					},
						{"name" : "Kayla",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#14 in USA"},
						]
					},
					]
				},
				{
					"name" : "Hispanic",
					"children" : [
						{"name" : "Isabella",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#2 in USA"},
						]
					},
						{"name" : "Mia",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#9 in USA"},
						]
					},
						{"name" : "Sophia",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#1 in USA"},
						]
					},
					]
				},
				{
					"name" : "White",
					"children" : [
						{"name" : "Esther",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#234 in USA"},
						]
					},
						{"name" : "Emma",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#3 in USA"},
						]
					},
						{"name" : "Olivia",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#4 in USA"},
						]
					},
					]
				}
			]
		}

	]
};


var twentyTwelve =
{
	"name" : "2012",
	"children" : [
		{
			"name" : "Male",
			"children" : [
				{
					"name" : "Asian and Pacific Islander",
					"children" : [
						{
							"name" : "Ryan",
							"children": [
								{"name": "#1 in NYC"},
								{"name " :"26 Nationally"},
							]	
					},
						{"name" : "Ethan",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#3 in USA"},
						]
					},
						{"name" : "Jayden",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#8 in USA"},
						]
					},
					]
				},
				{
					"name" : "Black",
					"children" : [
						{"name" : "Jayden",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#8 in USA"},
						]},
						{"name" : "Aiden",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#10 in USA"},
						]},
						{"name" : "Ethan",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#3 in USA"},
						]},
					]
				},
				{
					"name" : "Hispanic",
					"children" : [
						{"name" : "Jayden",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#8 in USA"},
						]},
						{"name" : "Jacob",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#1 in USA"},
						]},
						{"name" : "Matthew",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#12 in USA"},
						]},
					]
				},
				{
					"name" : "White",
					"children" : [
						{"name" : "Joseph",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#19 in USA"},
						]},
						{"name" : "David",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#10 in USA"},
						]},
						{"name" : "Michael",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#7 in USA"},
						]},
					]
				}
			]
		},
		{
			"name" : "Female",
			"children" : [
				{
					"name" : "Asian and Pacific Islander",
					"children" : [
						{"name" : "Chloe",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#11 in USA"},
						]},
						{"name" : "Sophia",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#1 in USA"},
						]},
						{"name" : "Olivia",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#4 in USA"},
						]},
					]
				},
				{
					"name" : "Black",
					"children" : [
						{"name" : "Madison",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#9 in USA"},
						]},
						{"name" : "London",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#94 in USA"},
						]},
						{"name" : "Taylor",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#46 in USA"},
						]},
					]
				},
				{
					"name" : "Hispanic",
					"children" : [
						{"name" : "Isabella",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#3 in USA"},
						]},
						{"name" : "Sophia",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#3 in USA"},
						]},
						{"name" : "Mia",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#8 in USA"},
						]},
					]
				},
				{
					"name" : "White",
					"children" : [
						{"name" : "Emma",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#2 in USA"},
						]},
						{"name" : "Leah",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#33 in USA"},
						]},
						{"name" : "Sarah",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#32 in USA"},
						]},
					]
				}
			]
		}

	]
};

var twentyThirteen =
{
	"name" : "2013",
	"children" : [
		{
			"name" : "Male",
			"children" : [
				{
					"name" : "Asian and Pacific Islander",
					"children" : [
						{"name" : "Jayden",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#9 in USA"},
						]},
						{"name" : "Ethan",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#6 in USA"},
						]},
						{"name" : "Ryan",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#16 in USA"},
						]},
					]
				},
				{
					"name" : "Black",
					"children" : [
						{"name" : "Ethan",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#8 in USA"},
						]},
						{"name" : "Jayden",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#7 in USA"},
						]},
						{"name" : "Aiden",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#2 in USA"},
						]},
					]
				},
				{
					"name" : "Hispanic",
					"children" : [
						{"name" : "Jayden",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#7 in USA"},
						]},
						{"name" : "Jacob",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#9 in USA"},
						]},
						{"name" : "Dylan",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#30 in USA"},
						]},
					]
				},
				{
					"name" : "White",
					"children" : [
						{"name" : "David",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#50 in USA"},
						]},
						{"name" : "Joseph",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#20 in USA"},
						]},
						{"name" : "Michael",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#14 in USA"},
						]},
					]
				}
			]
		},
		{
			"name" : "Female",
			"children" : [
				{
					"name" : "Asian and Pacific Islander",
					"children" : [
						{"name" : "Sophia",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#1 in USA"},
						]},
						{"name" : "Chloe",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#10 in USA"},
						]},
						{"name" : "Olivia",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#3 in USA"},
						]},
					]
				},
				{
					"name" : "Black",
					"children" : [
						{"name" : "Madison",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#12 in USA"},
						]},
						{"name" : "London",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#85 in USA"},
						]},
						{"name" : "Aaliyah",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#21 in USA"},
						]},
					]
				},
				{
					"name" : "Hispanic",
					"children" : [
						{"name" : "Isabella",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#4 in USA"},
						]},
						{"name" : "Sophia",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#1 in USA"},
						]},
						{"name" : "Mia",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#5 in USA"},
						]},
					]
				},
				{
					"name" : "White",
					"children" : [
						{"name" : "Olivia",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#3 in USA"},
						]},
						{"name" : "Emma",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#2 in USA"},
						]},
						{"name" : "Esther",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#224 in USA"},
						]},
					]
				}
			]
		}

	]
};


var twentyFourteen =
{
	"name" : "2014",
	"children" : [
		{
			"name" : "Male",
			"children" : [
				{
					"name" : "Asian and Pacific Islander",
					"children" : [
						{"name" : "Jayden",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#11 in USA"},
						]},
						{"name" : "Ethan",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#6 in USA"},
						]},
						{"name" : "Ryan",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#37 in USA"},
						]},
					]
				},
				{
					"name" : "Black",
					"children" : [
						{"name" : "Ethan",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#6 in USA"},
						]},
						{"name" : "Noah",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#1 in USA"},
						]},
						{"name" : "Aiden",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#14 in USA"},
						]},
					]
				},
				{
					"name" : "Hispanic",
					"children" : [
						{"name" : "Liam",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#2 in USA"},
						]},
						{"name" : "Dylan",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#29 in USA"},
						]},
						{"name" : "Jacob",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#4 in USA"},
						]},
					]
				},
				{
					"name" : "White",
					"children" : [
						{"name" : "Joseph",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#20 in USA"},
						]},
						{"name" : "David",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#18 in USA"},
						]},
						{"name" : "Michael",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#7 in USA"},
						]},
					]
				}
			]
		},
		{
			"name" : "Female",
			"children" : [
				{
					"name" : "Asian and Pacific Islander",
					"children" : [
						{"name" : "Olivia",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#2 in USA"},
						]},
						{"name" : "Chloe",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#18 in USA"},
						]},
						{"name" : "Sophia",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#3 in USA"},
						]},
					]
				},
				{
					"name" : "Black",
					"children" : [
						{"name" : "Madison",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#9 in USA"},
						]},
						{"name" : "Ava",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#5 in USA"},
						]},
						{"name" : "Chloe",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#18 in USA"},
						]},
					]
				},
				{
					"name" : "Hispanic",
					"children" : [
						{"name" : "Isabella",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#4 in USA"},
						]},
						{"name" : "Sophia",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#3 in USA"},
						]},
						{"name" : "Mia",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#6 in USA"},
						]},
					]
				},
				{
					"name" : "White",
					"children" : [
						{"name" : "Olivia",
						"children": [
							{"name": "#1 in NYC"},
							{"name": "#2 in USA"},
						]},
						{"name" : "Esther",
						"children": [
							{"name": "#2 in NYC"},
							{"name": "#202 in USA"},
						]},
						{"name" : "Rachel",
						"children": [
							{"name": "#3 in NYC"},
							{"name": "#155 in USA"},
						]},
					]
				}
			]
		}

	]
};

// setting the dimensions
var margin = {top: 20, right: 90, bottom: 30, left: 90},
width = 960 - margin.left - margin.right,
height = 500 - margin.top - margin.bottom;

// appends svg
var svg = d3.select("#tree").append("svg")
.attr("width", width + margin.right + margin.left)
.attr("height", height + margin.top + margin.bottom)
.append("g")
.attr("transform", "translate("
	  + margin.left + "," + margin.top + ")");

var i = 0,
duration = 750,
root;

// create tree map var
var treemap = d3.tree().size([height, width]);


// initialize starting 2011 tree
var dataJustChanged = 0;
root = d3.hierarchy(twentyEleven, function(d) { return d.children; });
rootWork(root);

// when the selector in html is clicked, change the data passed in
function dataChange() {
	if(document.getElementById('yearlist').value == "twentyeleven") {
		root = d3.hierarchy(twentyEleven, function(d) { return d.children; });
		rootWork(root);
		dataJustChanged = 1;
		
	}
	if(document.getElementById('yearlist').value == "twentytwelve") {
		root = d3.hierarchy(twentyTwelve, function(d) { return d.children; });
		rootWork(root);
		dataJustChanged = 1;
	}
	if(document.getElementById('yearlist').value == "twentythirteen") {
		root = d3.hierarchy(twentyThirteen, function(d) { return d.children; });
		rootWork(root)
		dataJustChanged = 1;
	}
	if(document.getElementById('yearlist').value == "twentyfourteen") {
		root = d3.hierarchy(twentyFourteen, function(d) { return d.children; });
		rootWork(root);
		dataJustChanged = 1;
	}
}

function rootWork(root){
	root.x0 = height / 2;
	root.y0 = 0;

	// only show first onde at first
	root.children.forEach(collapse);

	update(root);

	// hide all nodes after clicked
	function collapse(d) {
		if(d.children) {
		d._children = d.children
		d._children.forEach(collapse)
		d.children = null
		}
	}
}

function update(source) {
	// initialize tree
	dataJustChanged = 0;
	var treeData = treemap(root);
	var nodes = treeData.descendants(),
	links = treeData.descendants().slice(1);

	// depth of tree
	nodes.forEach(function(d){ d.y = d.depth * 180});


	// this stops the nodes from refreshing on every click, and only on the selects
	if (dataJustChanged == 1) {
		svg.selectAll('.node').remove();
		svg.selectAll('.node')
			.data(nodes)
			.enter()
			.append("g")
			dataJustChanged = 0;
			console.log(dataJustChanged);
	}
		
	// update
	var node = svg.selectAll('g.node')
	.data(nodes, function(d) {return d.id || (d.id = ++i); });

	// new node
	var nodeEnter = node.enter().append('g')
	.attr('class', 'node')
	.attr("transform", function(d) {
		return "translate(" + source.y0 + "," + source.x0 + ")";
	})
	.on('click', click);

	// circle for node
	nodeEnter.append('circle')
	.attr('class', 'node')
	.attr('r', 1e-6)
	.style("fill", function(d) {
		return d._children ? "mocasin" : "#FFE4B5";
	});

	// labels for node
	nodeEnter.append('text')
	.attr("dy", ".35em")
	.attr("x", function(d) {
		return d.children || d._children ? -13 : 13;
	})
	.attr("text-anchor", function(d) {
		return d.children || d._children ? "end" : "start";
	})
	.text(function(d) { return d.data.name; });

	// UPDATE
	var nodeUpdate = nodeEnter.merge(node);

	// put the node in the right place
	nodeUpdate.transition()
	.duration(duration)
	.attr("transform", function(d) { 
		return "translate(" + d.y + "," + d.x + ")";
	});

	// change node style 
	nodeUpdate.select('circle.node')
	.attr('r', 10)
	.style("fill", function(d) {
		return d._children ? "lightsteelblue" : "#fff";
	})
	.attr('cursor', 'pointer');


	// delete nodes
	var nodeExit = node.exit().transition()
	.duration(duration)
	.attr("transform", function(d) {
		return "translate(" + source.y + "," + source.x + ")";
	})
	.remove();

	// hide circles
	nodeExit.select('circle')
	.attr('r', 1e-6);

	// hide text
	nodeExit.select('text')
	.style('fill-opacity', 1e-6);


	var link = svg.selectAll('path.link')
	.data(links, function(d) { return d.id; });

	var linkEnter = link.enter().insert('path', "g")
	.attr("class", "link")
	.attr('d', function(d){
		var o = {x: source.x0, y: source.y0}
		return diagonal(o, o)
	});

	// UPDATE
	var linkUpdate = linkEnter.merge(link);

	linkUpdate.transition()
	.duration(duration)
	.attr('d', function(d){ return diagonal(d, d.parent) });

	var linkExit = link.exit().transition()
	.duration(duration)
	.attr('d', function(d) {
		var o = {x: source.x, y: source.y}
		return diagonal(o, o)
	})
	.remove();

	nodes.forEach(function(d){
	d.x0 = d.x;
	d.y0 = d.y;
	});

	// creating the path for the nodes
	function diagonal(s, d) {

	path = `M ${s.y} ${s.x}
			C ${(s.y + d.y) / 2} ${s.x},
			${(s.y + d.y) / 2} ${d.x},
			${d.y} ${d.x}`

	return path
	}

// onclick
	function click(d) {
	if (d.children) {
		d._children = d.children;
		d.children = null;
	} else {
		d.children = d._children;
		d._children = null;
	}
	update(d);
	}

}